#!/usr/bin/env python3
# coding: utf-8
# 基于训练好的词向量模型进行聚类
# 聚类采用Kmeans算法，并按照类内距离排序

import math
import re
import json
import jieba
import numpy as np
from gensim.models import Word2Vec
from sklearn.cluster import KMeans
from collections import defaultdict


# 加载训练好的模型
def load_word2vec_model(path):
    model = Word2Vec.load(path)
    return model


# 加载句子数据
def load_sentence(path):
    sentences = set()
    with open(path, encoding="utf8") as f:
        for line in f:
            sentence = line.strip()
            sentences.add(" ".join(jieba.cut(sentence)))
    print("获取句子数量：", len(sentences))
    return sentences


# 将文本向量化
def sentences_to_vectors(sentences, model):
    vectors = []
    for sentence in sentences:
        words = sentence.split()
        vector = np.zeros(model.vector_size)
        valid_word_count = 0
        for word in words:
            try:
                vector += model.wv[word]
                valid_word_count += 1
            except KeyError:
                continue
        if valid_word_count > 0:
            vector /= valid_word_count
        vectors.append(vector)
    return np.array(vectors)


def main():
    model = load_word2vec_model("model.w2v")  # 修改为你的模型路径
    sentences = list(load_sentence("titles.txt"))  # 转换为列表保持索引顺序
    vectors = sentences_to_vectors(sentences, model)

    n_clusters = int(math.sqrt(len(sentences)))
    print("指定聚类数量：", n_clusters)

    kmeans = KMeans(n_clusters)
    kmeans.fit(vectors)

    # 获取每个簇的中心点
    centroids = kmeans.cluster_centers_

    # 存储每个簇的(句子, 距离中心距离)元组
    cluster_dict = defaultdict(list)

    # 计算每个句子到其簇中心的距离
    for i, (sentence, label) in enumerate(zip(sentences, kmeans.labels_)):
        vec = vectors[i]
        centroid = centroids[label]
        distance = np.linalg.norm(vec - centroid)  # 欧氏距离
        cluster_dict[label].append((sentence, distance))

    # 按类内距离排序并输出结果
    for label, items in cluster_dict.items():
        # 按距离从小到大排序 (距离越小越接近中心)
        sorted_items = sorted(items, key=lambda x: x[1])

        print(f"\ncluster {label}")
        print("=" * 50)

        for j, (sentence, distance) in enumerate(sorted_items[:5]):  # 取前5个最近的
            print(f"{j + 1}. {sentence.replace(' ', '')} \t[距离: {distance:.4f}]")

    # 添加类间分离度信息
    center_distances = []
    for i in range(len(centroids)):
        for j in range(i + 1, len(centroids)):
            dist = np.linalg.norm(centroids[i] - centroids[j])
            center_distances.append(dist)

    avg_cluster_distance = sum(center_distances) / len(center_distances) if center_distances else 0
    print(f"\n{'=' * 50}\n聚类评估：")
    print(f"平均类间中心距离: {avg_cluster_distance:.4f}")
    print(f"最大类间中心距离: {max(center_distances) if center_distances else 0:.4f}")
    print(f"最小类间中心距离: {min(center_distances) if center_distances else 0:.4f}")


if __name__ == "__main__":
    main()

"""
cluster 31
==================================================
1. 陈经纶中学宋洪谈北京中学生校园摄影活动（图） 	[距离: 0.4920]
2. 2010苏园艺术季当代名家书画展圆满落幕（组图） 	[距离: 0.5220]
3. 时装周大面试举行新丝路名模悉数亮相（图） 	[距离: 0.5594]
4. 华侨银行（中国）个人网银启动 	[距离: 0.5968]
5. 日本拟在12月举行夺回远离本土海岛军演（图） 	[距离: 0.6244]

cluster 41
==================================================
1. 娄艺潇《鹿鼎记》变“贱”宁公主搞笑引围观 	[距离: 0.2864]
2. 《钢刀》热映“双东”相爱想杀成火热硬汉CP 	[距离: 0.3060]
3. 《天师归来》开机“僵尸片鼻祖”刘观伟执导 	[距离: 0.3834]
4. 葛天加盟《女神学院》扮“院长”姚橹颠覆形象 	[距离: 0.4061]
5. 《小鸟》中美首周票房夺双冠“小恶魔”献声神鹰 	[距离: 0.4079]

cluster 8
==================================================
1. 《封神英雄榜》新春首播吴卓翰演绎最帅纣王 	[距离: 0.3536]
2. 《黄金时代》曝宣传曲MV罗大佑林夕再度携手 	[距离: 0.3537]
3. 话剧《盗墓笔记》破多项纪录被评像真人秀电影 	[距离: 0.3791]
4. 侯明昊新歌《超能奶爸》首播冲击潮流电子乐 	[距离: 0.3824]
5. 《幸福36计》开播焦俊艳为婆媳关系苦学兵法 	[距离: 0.4354]

cluster 13
==================================================
1. 美欧酝酿推出第二波量化宽松政策 	[距离: 0.5711]
2. 债券之王格罗斯因糟糕业绩向客户致歉 	[距离: 0.5745]
3. 闲置银行卡网络黑市出价百元收购 	[距离: 0.5800]
4. 兴业银行理财产品涉嫌违规持有人大亏1.22亿 	[距离: 0.5848]
5. 香港金管局再注资38.83亿应对东亚银行挤提事件 	[距离: 0.6367]

cluster 1
==================================================
1. 预防针：留学生须警惕英国“野鸡大学” 	[距离: 0.4594]
2. 留学服务：“隐形的翅膀”助我腾飞 	[距离: 0.4612]
3. 专家解读：留学无语言录取的“雷区” 	[距离: 0.4700]
4. 预警：当心留学美国“宰”你没商量 	[距离: 0.4902]
5. 专家解答：通过“双录取”可读何种名校 	[距离: 0.5270]

cluster 19
==================================================
1. 反垄断指南划违规红线厂商争抢售后客源 	[距离: 0.4405]
2. 媒体总结薄萧会谈密件外流五种可能 	[距离: 0.5279]
3. 中消协消指部主任王前虎谈近年购房纠纷变化 	[距离: 0.5334]
4. 环球科学：脑机接口未来直接向大脑写入记忆 	[距离: 0.5466]
5. 暴雪自打耳光评1.25补丁诸多修改 	[距离: 0.5815]

cluster 5
==================================================
1. 角斗士凉鞋这边潮起那边潮落 	[距离: 0.4399]
2. 黑市废旧桌凳变身昂贵古董 	[距离: 0.4581]
3. 这个希腊小众秘境好玩的不止圣托里尼 	[距离: 0.5417]
4. 反响｜当代艺术是美国的阴谋，艺术圈怎么看？ 	[距离: 0.5501]
5. 欧洲最适宜居住的地方居然是这座长寿岛! 	[距离: 0.5527]

cluster 40
==================================================
1. 陈楚生音乐节融入synthpop元素嗨唱贵阳万人趴 	[距离: 0.3774]
2. 叮叮车香港街头的独特风景 	[距离: 0.5110]
3. 民调评奥运经典之笑朱启南含泪微笑得票最高 	[距离: 0.5674]
4. 一场忐忑之旅体验神奇又可怕的印度火车 	[距离: 0.5681]
5. 两斤腊肉换回唐代陶质辟雍砚 	[距离: 0.5788]

cluster 33
==================================================
1. 二炮靶场模拟攻击美冲绳基地停机坪布满弹坑 	[距离: 0.4286]
2. 美军滨海战斗舰驶近南海岛屿解放军严密监控 	[距离: 0.4480]
3. 南海舰队实弹训练052D舰新型隐身舰炮开火 	[距离: 0.5286]
4. 菲军特种部队秘照曝光赤身裸体合练怪招 	[距离: 0.5442]
5. 中国东海舰队新型三代机亮相空军驾机空中格斗 	[距离: 0.5446]

cluster 12
==================================================
1. 山东捕获3300斤重大鲨鱼（图） 	[距离: 0.3478]
2. 59岁农民患癌症签下遗体捐献登记表（图） 	[距离: 0.4003]
3. 科学家揭开5000年前冰人奥茨身份之谜（图） 	[距离: 0.4100]
4. 首开常青藤持续热销六月底加售新楼栋（图） 	[距离: 0.4117]
5. 长春盲人小伙勇于挑战雅思获得七分（图） 	[距离: 0.4193]

cluster 7
==================================================
1. 大族激光：谷底已过前途光明 	[距离: 0.4192]
2. 揭秘东北私彩：高返奖成诱饵私彩成公彩的寄生虫 	[距离: 0.4356]
3. 诺贝尔文学奖得主门罗：角色应背叛实际生活 	[距离: 0.5223]
4. 任九场专区：巴西土耳其做胆荷兰阿根廷尽量避开 	[距离: 0.5241]
5. 老无所依：德州第一老农一代乔丹接班人退出舞台 	[距离: 0.5254]

cluster 30
==================================================
1. 火箭惨烈一战折后场双枪马丁一瘸一拐战群狼成疑 	[距离: 0.4155]
2. 篮球麦加火箭期待首场连胜斯科拉扣篮未遂遭嘲笑 	[距离: 0.4263]
3. 老鹰惨负雄鹿遭到三连败铁血爵士再逆转拆穿魔术 	[距离: 0.4829]
4. 魔术尼尔森因伤缺战山猫杜洪成卡特后场临时搭档 	[距离: 0.4988]
5. Fly逆转UnaInfi精灵擒Yumiko 	[距离: 0.5112]

cluster 37
==================================================
1. “汉文文书”成功入选世界记忆亚太地区名录 	[距离: 0.4876]
2. 金融街购物中心“幻装”时装秀盛大开幕 	[距离: 0.5040]
3. “日军占领新加坡证言集”申请世界记忆遗产未如愿 	[距离: 0.5095]
4. “DNA之父”诺贝尔奖章拍卖成交价475万美元 	[距离: 0.5214]
5. “哈利波特”译者告出版社胜诉称出版界维权难 	[距离: 0.5263]

cluster 14
==================================================
1. 海南航空：关联交易增厚四季度业绩 	[距离: 0.4452]
2. 经纬纺机：控股中融业绩爆发式增长 	[距离: 0.4515]
3. 银轮股份：明年看乘用车前端模块 	[距离: 0.5323]
4. 凯迪电力：生物质电厂逐步进入收获期 	[距离: 0.5547]
5. 蓝色光标：利润高速增长整合收购更值期待 	[距离: 0.5693]

cluster 35
==================================================
1. 中行信用卡办卡承诺不收费如今翻脸收20元年费 	[距离: 0.5495]
2. 经适房房主上演自买自卖 	[距离: 0.5545]
3. 西安数千学子莫名办理信用卡学校银行深陷卡门 	[距离: 0.5912]
4. 卡在手上钱被盗储户状告银行讨损失 	[距离: 0.6169]
5. 转账卡摇身变成信用卡莫名透支利息反超本金 	[距离: 0.6262]

cluster 18
==================================================
1. 快速戒酒的土方法喝酒的危害真的大 	[距离: 0.5915]
2. 法令纹怎么消除法令纹产生的原因 	[距离: 0.6246]
3. 怎样判断肝炎以下症状要警惕 	[距离: 0.6393]
4. 避孕药的禁忌十类女性要谨慎 	[距离: 0.6501]
5. 产生黄疸的病因这些病因要注意 	[距离: 0.6699]

cluster 28
==================================================
1. 东风御风完美保障中国卡车公开赛上海站 	[距离: 0.5520]
2. 中粮万科长阳半岛祥云湾全新产品即将绽放 	[距离: 0.5639]
3. 金龙携四大品牌亮相2016北京道路运输展! 	[距离: 0.6142]
4. 英菲尼迪启动敢爱行动u3000今年6款新车上市 	[距离: 0.6257]
5. 全新卡罗拉受瞩目一汽丰田闪耀长春车展 	[距离: 0.6391]

cluster 24
==================================================
1. 十一倒计时:首批"不用带钱包"的境外目的地出炉 	[距离: 0.4750]
2. 惊人的超低价！探访美国"穷人"专用平价超市 	[距离: 0.4767]
3. 最委屈的"国王":3平米城堡住22年坏了自己修 	[距离: 0.5041]
4. 缤纷假期别样趣味!酷航启动"暑假作业专机" 	[距离: 0.5325]
5. 打卡取景地跟着恐龙回"侏罗纪"看看！ 	[距离: 0.5867]

cluster 20
==================================================
1. 300多平庭院微妙细节尽显日式风尚（组图） 	[距离: 0.3380]
2. DIY唯美餐具渲染温婉氛围（组图） 	[距离: 0.3488]
3. 一款棉麻材质的韩式窗帘（图） 	[距离: 0.3700]
4. 中式边几搭配金属镜面花瓶（图） 	[距离: 0.3930]
5. 主卧空间的本质讲究精致（图） 	[距离: 0.4237]

cluster 36
==================================================
1. 另辟蹊径：留学何处语言不再是拦路虎 	[距离: 0.4953]
2. 留学预警：十所新加坡学校不能招国际生 	[距离: 0.5096]
3. 留学路：我用离职费在澳洲攻读硕士 	[距离: 0.5111]
4. 这边风景独好：高考生留学摆脱独木桥 	[距离: 0.5493]
5. 成才新途径：国内留学加上国外深造 	[距离: 0.5701]

cluster 11
==================================================
1. 重磅解答：赴澳读硕士有啥快捷通道（图） 	[距离: 0.3998]
2. 留法校长的人文情怀：川外女生不是花瓶（组图） 	[距离: 0.4603]
3. 反抗：英国中学禁止女生穿短裙遭罢课（图） 	[距离: 0.4828]
4. 李铁强自述掌声的背后：吃苦的幸福（图） 	[距离: 0.4956]
5. 对话王辉耀：海归创业面临的困难（图） 	[距离: 0.4960]

cluster 9
==================================================
1. 渔民江中捕获珍稀动物鼋数量少于大熊猫 	[距离: 0.4223]
2. 奥巴马3D打印塑像出炉打印花费40个小时 	[距离: 0.4395]
3. 广西凤山原书记花5350万刻壁画超县财政收入一半 	[距离: 0.4499]
4. 森萨塔年内并购施莱德u3000明年增收5亿美元 	[距离: 0.4954]
5. 大批武警官兵力守鄱阳湖大堤搬运沙袋6000袋 	[距离: 0.5002]

cluster 38
==================================================
1. 勒布朗励志广告片遭球迷恶搞天之骄子沦为詹跑跑 	[距离: 0.4054]
2. 皮尔斯赢球微博讽刺勒布朗恶搞皇帝艰难决定台词 	[距离: 0.4273]
3. 比伯被捕时豪车藏嫩模同出夜店暧昧 	[距离: 0.4356]
4. 子开车致人死父替儿顶罪自首两人皆获刑 	[距离: 0.4377]
5. 意大利卷入欧债风暴眼罗杰斯抛出破产疗法 	[距离: 0.4611]

cluster 0
==================================================
1. 哪种睡姿可以缓解打鼾治疗打鼾吃什么 	[距离: 0.8113]
2. 座疮的治疗方法教你赶走痤疮 	[距离: 0.8219]
3. 喝什么茶能治疗高血压治疗高血压偏方 	[距离: 0.8258]
4. 维生素b6能治哪些病孕妇不宜过量服维生素b6 	[距离: 0.8334]
5. 艾叶能治疗荨麻疹吗艾叶的作用 	[距离: 0.8374]

cluster 16
==================================================
1. 委内瑞拉举行军演女民兵持枪上阵玩自拍 	[距离: 0.5588]
2. WCG2009总决赛开通媒体参会绿色通道 	[距离: 0.5788]
3. TED夺得IEF2009上海区魔兽项目冠军 	[距离: 0.5803]
4. WCG2009世界总决赛场馆分布图 	[距离: 0.5850]
5. 中华台北奥运代表团开幕式出场顺序确定 	[距离: 0.5956]

cluster 15
==================================================
1. 组图：王菲个性高跟鞋尽显巨星范儿 	[距离: 0.3925]
2. 组图：女星展示性感身材内衣选择有一套 	[距离: 0.4911]
3. 组图：甜美Girl扮靓一周的小秘诀 	[距离: 0.5071]
4. 搭配QA：最显瘦高8款韩式长短搭 	[距离: 0.5240]
5. 组图：四川妹子的街头麻辣装扮 	[距离: 0.5306]

cluster 2
==================================================
1. 通用5年内在华增投140亿美元欲抗衡大众 	[距离: 0.5255]
2. 华远九都汇热销10亿亚太巡展香港首站飘红 	[距离: 0.5378]
3. 北京福彩3D中秋加奖20%国庆30%7玩法均包含其中 	[距离: 0.5402]
4. 新增资金入场沪胶强势创年内新高 	[距离: 0.5578]
5. 新能源车再获40亿财政补贴扶持力度提升 	[距离: 0.5803]

cluster 22
==================================================
1. 詹俊初盘推荐：朴茨茅曼城拒绝平局阿森纳防冷门 	[距离: 0.3266]
2. 张路足彩推荐：伤病罗马步履蹒跚米兰德比首选平 	[距离: 0.3808]
3. 火线赔率统计：警惕AC米兰输球佛罗伦轻取巴勒莫 	[距离: 0.3834]
4. 戴维火线推荐：拜仁主场首选平局皇马客场藏大冷 	[距离: 0.3839]
5. 差异指数火线：半球盘尤文客战不败桑坦德可博胆 	[距离: 0.3847]

cluster 39
==================================================
1. 台湾首证实正研无人攻击机欲侦察大陆军用机场 	[距离: 0.4534]
2. 大批外军陈兵俄边境俄王牌武器坐镇克里米亚 	[距离: 0.4739]
3. 国台办否认两岸百名退役将领参加辛亥纪念活动 	[距离: 0.5028]
4. IMF总裁下周访华求解国际汇率难题 	[距离: 0.5449]
5. 美重提所谓对台防卫承诺议员要求政府售台战机 	[距离: 0.5590]

cluster 29
==================================================
1. 上班族护肤的策略教你养出好肌肤 	[距离: 0.5763]
2. 女人怎么健康穿鞋高跟鞋多高合适 	[距离: 0.6465]
3. 针灸减肥误区三大误区你犯了吗 	[距离: 0.6936]
4. 油性皮肤该怎么办教你留住清爽 	[距离: 0.7106]
5. 春季养生小常识教你养出好身体 	[距离: 0.7156]

cluster 34
==================================================
1. 炫酷！吉克隽逸变白发魔女玩“隐身”成独臂侠 	[距离: 0.5154]
2. 刘醒龙谈写作：用理想的“有”来抵抗世俗的“无” 	[距离: 0.5469]
3. 古石刻现“爸爸去哪儿”南朝古墓3辟邪相依偎 	[距离: 0.5479]
4. 孝感2千人自称岳飞后裔:家家挂岳飞像唱“满江红” 	[距离: 0.5640]
5. “勇士”贾玲的喜剧理想 	[距离: 0.5760]

cluster 6
==================================================
1. 皮尔斯生涯五大里程碑征服湖人逼奥胖送真理称号 	[距离: 0.4359]
2. 奥博托重返马刺万人起立欢呼姚明走时休城会怎样 	[距离: 0.4866]
3. 赢球只因寻回老火箭风采阿帅请牢记防守的价值！ 	[距离: 0.5075]
4. 一生必去一次以色列离上帝最近的哭墙 	[距离: 0.5133]
5. 硬起来！美专家苦劝阿联内线艰难外线失准不给力 	[距离: 0.5400]

cluster 10
==================================================
1. 印度国产新型无人机首次试飞时坠毁（图） 	[距离: 0.4658]
2. 俄罗斯侦察机飞临日本近海遭多架战机拦截（图） 	[距离: 0.4708]
3. 黎巴嫩防空部队向进入领空以色列战机开火（图） 	[距离: 0.5556]
4. 法国与俄罗斯签约将共建四艘两栖攻击舰（图） 	[距离: 0.5599]
5. 俄罗斯图-95轰炸机巡逻中遭挪威战机跟踪（图） 	[距离: 0.5622]

cluster 21
==================================================
1. 网民文化节定为9月14日 	[距离: 0.5830]
2. 上合组织反恐军演9月9日起在哈萨克斯坦举行 	[距离: 0.6181]
3. APEC国礼将亮相文博会11日至14日展出 	[距离: 0.6375]
4. 据称四川达州通川区婚姻登记处8月8日不办离婚 	[距离: 0.6697]
5. 罗琦与冷空气紧锣密鼓排练备战1月24北京个唱 	[距离: 0.6739]

cluster 32
==================================================
1. 《雏菊》荷兰乡村别墅（图） 	[距离: 0.2480]
2. 《越狱》主角米帅家居生活照（组图） 	[距离: 0.3189]
3. 《美国派》北美别墅（图） 	[距离: 0.3557]

cluster 17
==================================================
1. 工行状告三名信用卡负翁信用记录列为禁入 	[距离: 0.5214]
2. 手续费最高21.6%信用卡免息分期付款藏陷阱 	[距离: 0.5619]
3. 信用卡半年未偿额大增131.1%央行警示坏账风险 	[距离: 0.6027]
4. 同行同名信用卡还款引纠纷市民起诉银行 	[距离: 0.6154]
5. 五招玩转信用卡境外消费 	[距离: 0.6369]

cluster 26
==================================================
1. 关小刀火线解盘：桑普力擒巴勒莫马竞客场谋反弹 	[距离: 0.3517]
2. 戴维火线推荐：赫尔城好运到头霍芬海姆脚步放缓 	[距离: 0.4170]
3. 关小刀火线推荐：低迷西汉姆难胜态勇多特做博胆 	[距离: 0.4472]
4. 安然胜负彩火线解盘：德国力斩俄罗斯阿根廷稳胆 	[距离: 0.4512]
5. 盘口任选九场：联盟杯冷门高发拜仁战意不足避开 	[距离: 0.4551]

cluster 3
==================================================
1. 享有美味的梦境（图） 	[距离: 0.2932]
2. 三明治瓷砖来源于三明治（图） 	[距离: 0.3519]
3. 东方文化魅力的梅花壁纸（图） 	[距离: 0.3797]
4. 优雅的沙发椅必不可少（图） 	[距离: 0.3801]
5. 乡村风格的书桌（图） 	[距离: 0.3842]

cluster 25
==================================================
1. 大学生在医院厕所欲强奸女病人被判刑 	[距离: 0.4240]
2. 解放军海外驾车送家书遭遇狂风车差点被吹翻 	[距离: 0.4747]
3. 民工率领30余人拉条幅讨薪被歹徒砍伤 	[距离: 0.5093]
4. 男子怀疑被女友骗钱买来液化气欲自杀 	[距离: 0.5440]
5. 2名女子因被老板开除相约自杀 	[距离: 0.5602]

cluster 27
==================================================
1. 纽约黄金期货再创新高收报1589.30美元 	[距离: 0.4424]
2. 欧佩克原油价格周二跌破70美元 	[距离: 0.4666]
3. 纽约原油期货周五收盘上涨2.5% 	[距离: 0.5748]
4. 伦敦市场周三现货金一度突破942美元 	[距离: 0.5926]
5. 黄金期货平收期铜大涨3% 	[距离: 0.6041]

cluster 4
==================================================
1. 双色球09003期：湖南爆1注1400万头奖奖池1.84亿 	[距离: 0.3921]
2. 胜负彩08064期开奖：头奖爆火锅每注9千2等253元 	[距离: 0.4658]
3. 胜负彩09010期任选9场开奖：头奖744注每注1万7 	[距离: 0.5337]
4. 胜负彩08060期任选9场开奖：头奖878注每注1万3 	[距离: 0.5432]
5. 4场进球彩09001期开奖：一等奖82注每注奖金2万6 	[距离: 0.5774]

cluster 23
==================================================
1. 前4月进口矿石多花857亿钢铁业利润率降至2.86% 	[距离: 0.6087]
2. 10月足彩赛程：密度大幅提升欧冠世界杯再度入围 	[距离: 0.7404]
3. 欧元汇率创自2008年10月以来新低 	[距离: 0.7539]
4. 长安街CBD核心精装现房长安8号预计09年年底开盘 	[距离: 0.7570]
5. 亚太区股市个别发展台股收至13个月高位 	[距离: 0.8275]

==================================================
聚类评估：
平均类间中心距离: 1.4546
最大类间中心距离: 2.9262
最小类间中心距离: 0.5404
"""
